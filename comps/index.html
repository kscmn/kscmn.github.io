<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LZD9DR8ZX5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-LZD9DR8ZX5');
    </script>

    <title>Sports Card Comps | Kato Sports Cards</title>
    
    <link rel="stylesheet" href="https://kscmn.com/style.css">

    <style>
        /* Specific styles for the Comps results display */
        #resultsArea { margin-top: 30px; display: none; }
        .avg-container { padding: 20px; background: var(--accent-light, #e7f1ff); border-radius: 8px; margin-bottom: 20px; }
        .price-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .loader { color: var(--primary); font-weight: bold; padding: 20px; }
        .error-msg { color: #dc3545; background: #fff5f5; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <nav class="breadcrumbs">
        <a href="https://kscmn.com">Home</a> &nbsp;/&nbsp; Comps
    </nav>

    <main class="ksc-card">
        <h1>Card Comps</h1>
        <p style="color: var(--text-muted); margin-bottom: 25px;">Find recent eBay sold prices instantly.</p>
        
        <form id="compsForm">
            <input type="text" id="cardQuery" class="search-input" placeholder="e.g. 2024 Topps Series 1 Elly De La Cruz" required>
            <button type="submit" class="ksc-button">Get Sold Comps</button>
        </form>

        <div id="status" class="loader" style="display:none;">Searching eBay Market Data...</div>

        <div id="resultsArea">
            <div class="avg-container">
                <div style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted);">Average Sold Price</div>
                <div id="avgPrice" style="color: var(--primary); font-size: 2.5rem; font-weight: 800;">$0.00</div>
                <div id="saleCount" style="font-size: 0.85rem; color: var(--text-muted);">Based on last 0 sales</div>
            </div>

            <div id="soldList"></div>
            
            <div style="margin-top: 20px;">
                <a id="ebayLink" href="#" target="_blank" class="secondary-link" style="width: 100%;">View All Results on eBay</a>
            </div>
        </div>
    </main>
</div>

<footer>
    <div class="footer-copyright">Â© 2026 Kato Sports Cards. All Rights Reserved.</div>
    <div class="location-text">Mankato, Minnesota</div>
</footer>

<script>
document.getElementById('compsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const query = document.getElementById('cardQuery').value;
    const status = document.getElementById('status');
    const resultsArea = document.getElementById('resultsArea');
    const soldList = document.getElementById('soldList');
    const avgDisplay = document.getElementById('avgPrice');

    status.style.display = 'block';
    status.innerText = "Fetching Market Data...";
    resultsArea.style.display = 'none';

    try {
        const workerUrl = `https://ebay-comps-api.katosportscards.workers.dev/?q=${encodeURIComponent(query)}`;
        const response = await fetch(workerUrl);
        const data = await response.json();

        if (data.prices && data.prices.length > 0) {
            // Calculate Average
            const sum = data.prices.reduce((a, b) => a + b, 0);
            const avg = sum / data.prices.length;
            
            avgDisplay.innerText = `$${avg.toFixed(2)}`;
            document.getElementById('saleCount').innerText = `Based on last ${data.prices.length} sales`;
            
            // Build the list of sales
            soldList.innerHTML = data.prices.map((p, i) => `
                <div class="price-item">
                    <span>Recent Sale ${i + 1}</span>
                    <strong>$${p.toFixed(2)}</strong>
                </div>
            `).join('');

            status.style.display = 'none';
            resultsArea.style.display = 'block';
        } else {
            status.innerText = "No sales found. Try a broader search.";
        }
    } catch (err) {
        status.innerText = "Connection Error. Check your Worker status.";
        console.error(err);
    }
});</script>

</body>
</html>
