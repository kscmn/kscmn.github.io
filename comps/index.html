se<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LZD9DR8ZX5"></script>
    <script>
      async function getComps(searchTerm) {
    const workerUrl = `https://ebay-comps-api.your-subdomain.workers.dev/?q=${encodeURIComponent(searchTerm)}`;
    
    const response = await fetch(workerUrl);
    const html = await response.text();
    
    // Use a DOMParser to find prices in the returned HTML
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    const prices = doc.querySelectorAll('.s-item__price');
    
    // Example: Show the first 5 sold prices
    prices.forEach((p, index) => {
        if(index < 5) console.log("Sold Price:", p.innerText);
    });
}

    </script>

    <title>Sports Card Comps | Kato Sports Cards Research</title>
    <meta name="description" content="Quickly find sports card comps using eBay sold listings. Research market values for Baseball, Basketball, and Football cards.">
    
    <link rel="stylesheet" href="https://kscmn.com/style.css">
</head>
<body>

<div class="container">
    <nav class="breadcrumbs">
        <a href="https://kscmn.com">Home</a> &nbsp;/&nbsp; Comps
    </nav>

    <main class="ksc-card">
        <h2>Card Comps</h2>
        <p style="color: var(--text-muted); margin-bottom: 25px;">
            Search recent eBay sold listings to find the current market value of your cards.
        </p>
        
        <form id="compsSearchForm">
            <input type="text" id="query" class="search-input" placeholder="e.g. 2023 Bowman Draft Paul Skenes" required>
            <button type="submit" class="ksc-button">Get Sold Comps</button>
        </form>
        
        <div style="margin-top: 20px; font-size: 0.8rem; color: #aaa;">
            Tip: Be specific (Year, Set, Player, Grade) for better results.
        </div>
    </main>
</div>
<main class="ksc-card">
    <h2>Market Comps</h2>
    <form id="compsForm">
        <input type="text" id="cardQuery" class="search-input" placeholder="e.g. 2023 Prizm Stroud PSA 10" required>
        <button type="submit" class="ksc-button">Get Live Comps</button>
    </form>

    <div id="resultsArea" style="margin-top: 30px; display: none;">
        <h3 id="avgPrice" style="color: var(--primary); font-size: 2rem;">--</h3>
        <p style="font-size: 0.8rem; color: var(--text-muted);">Average of last 10 sales</p>
        <hr border="0" height="1px" background="#eee">
        <div id="soldList" style="text-align: left; max-width: 400px; margin: 0 auto;"></div>
    </div>
</main>

<script>
document.getElementById('compsForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const query = document.getElementById('cardQuery').value;
    const resultsArea = document.getElementById('resultsArea');
    const soldList = document.getElementById('soldList');
    
    // Replace with your actual Worker URL
    const workerUrl = `https://your-worker-name.your-subdomain.workers.dev/?q=${encodeURIComponent(query)}`;

    resultsArea.style.display = 'block';
    soldList.innerHTML = "Fetching current market data...";

    try {
        const resp = await fetch(workerUrl);
        const html = await resp.text();
        const doc = new DOMParser().parseFromString(html, 'text/html');
        const priceElements = doc.querySelectorAll('.s-item__price');
        
        let total = 0;
        let count = 0;
        soldList.innerHTML = "";

        priceElements.forEach((el, i) => {
            if (i > 0 && count < 10) { // Skip eBay's "suggested" first item
                const priceText = el.innerText.replace(/[^0-9.]/g, '');
                const price = parseFloat(priceText);
                
                if (!isNaN(price)) {
                    total += price;
                    count++;
                    soldList.innerHTML += `<div style="padding: 5px 0; border-bottom: 1px solid #f0f0f0;">Sale ${count}: **$${price.toFixed(2)}**</div>`;
                }
            }
        });

        const avg = total / count;
        document.getElementById('avgPrice').innerText = `$${avg.toFixed(2)}`;
        
    } catch (err) {
        soldList.innerHTML = "Error fetching data. Check your Worker URL or CORS settings.";
    }
});
</script>

<footer>
    <div class="footer-copyright">Â© 2026 Kato Sports Cards. All Rights Reserved.</div>
    <div class="location-text">Mankato, Minnesota</div>
</footer>

<script>
    document.getElementById('compsSearchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const searchTerms = document.getElementById('query').value;
        // LH_Sold=1: Sold items, LH_Complete=1: Completed items, _sop=13: Recent first
        const ebayUrl = `https://www.ebay.com/sch/i.html?_nkw=${encodeURIComponent(searchTerms)}&LH_Sold=1&LH_Complete=1&_sop=13`;
        window.open(ebayUrl, '_blank');
    });
</script>

</body>
</html>
